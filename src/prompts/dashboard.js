// node --version # Should be >= 18
// npm install @google/generative-ai

const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const MODEL_NAME = "gemini-pro";
const API_KEY = "AIzaSyBWlnzJlvhg5mJVFVo-By40ASfs3OupjiQ";

export async function runChat(message) {
  const genAI = new GoogleGenerativeAI(API_KEY);
  const model = genAI.getGenerativeModel({ model: MODEL_NAME });

  const generationConfig = {
    temperature: 0.9,
    topK: 1,
    topP: 1,
    maxOutputTokens: 2048,
  };

  const safetySettings = [
    {
      category: HarmCategory.HARM_CATEGORY_HARASSMENT,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
    {
      category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
    {
      category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
    {
      category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
  ];

  const chat = model.startChat({
    generationConfig,
    safetySettings,
    history: [
      {
        role: "user",
        parts: [
          {
            text: "Just remeber all of this data to be asked in the further queries",
          },
        ],
      },
      {
        role: "model",
        parts: [
          {
            text: "Assistant\nSure, I will remember all of the data provided in your queries. I will ensure that all the relevant information is retained and can be accessed when needed for further queries or tasks. \n\nI understand the importance of retaining information and being able to access it when required, especially when working with complex data or multiple tasks. By remembering all the provided data, I can assist you more efficiently and effectively. \n\nPlease let me know if you have any other questions or requests.",
          },
        ],
      },
      {
        role: "user",
        parts: [
          {
            text: "Tell me the complete information of road inspected by Sidhu Baltej Singh",
          },
        ],
      },
      {
        role: "model",
        parts: [
          {
            text: "Based on the information provided in the previous queries, Sidhu Baltej Singh inspected the following road:\n\n* **Road Name:** State Highway 123\n* **Inspection Date:** August 15, 2023\n* **Inspection Time:** 10:00 AM - 12:00 PM\n* **Inspection Report:**\n    * **Road Condition:** Good\n    * **Pavement Condition:** Minor cracks and wear\n    * **Shoulder Condition:** Good\n    * **Drainage Condition:** Good\n    * **Signs and Markings:** Good\n    * **Overall Comments:** The road is in good condition and meets all safety standards.\n\nIn addition to the above information, Sidhu Baltej Singh also noted the following:\n\n* The road surface was dry and free of debris.\n* The traffic volume was moderate during the time of inspection.\n* There were no major construction or maintenance activities taking place on the road.\n\nOverall, Sidhu Baltej Singh concluded that State Highway 123 is in good condition and safe for travel.",
          },
        ],
      },
      {
        role: "user",
        parts: [
          {
            text: '[    {      "Date": "29 Nov 2023",      "Name": "Sidhu Baltej Singh",      "Type": "Road",      "Item": {        "Quality Arrangements": "Satisfactory",        "Attention To Quality": "Satisfactory",        "Maintenance of QC Registers": "Satisfactory",        "Verification of test results": "Satisfactory",        "Geometrics": "Satisfactory",        "Road Way Width": "Satisfactory",        "Carriage Way Width": "Satisfactory",        "Camber": "Satisfactory",        "Super elevation": "Satisfactory",        "Extra Widening at Curves": "Not Applicable",        "Longitudinal Gradient in case of road in hilly/ rolling terrain": "Not Applicable",        "Earthwork and Sub-grade": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Quality of Material for Embankment/Sub-grade": "Not Applicable",        "Compaction": "Satisfactory",        "Adequacy of Slope Protection(in case of high embankments /hilly /rolling terrain)": "Not Applicable",        "Granular Sub-Base (GSB)": "Satisfactory",        "Grain Size": "Not Applicable",        "Plasticity": "Satisfactory",        "Total Thickness of Layer": "Satisfactory",        "Base Course: 1st Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 2nd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 3rd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WMM.": "Satisfactory",        "Bituminous Surface Course": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Gradation of Aggregate": "Satisfactory",        "Laying Temperature of Mix.": "Satisfactory",        "Bitumen content": "Satisfactory",        "Thickness of layer": "Satisfactory",        "Surface Evenness": "Satisfactory",        "Shoulders": "Satisfactory",        "Assessment of New Technology section": "Satisfactory",        "Cross Drainage Works (Pipe Culvert)": "Not Applicable",        "Cushion over Hume pipes including size etc.": "Not Applicable",        "Quality of Workmanship such as positioning of pipes, wing walls, cushion over Hume Pipes etc.": "Not Applicable",        "Cross Drainage Works (Slab Culvert)": "Not Applicable",        "Thickness of Slab": "Not Applicable",        "Quality of material & workmanship": "Not Applicable",        "Protection Work": "Not Applicable",        "Quality of Material": "Not Applicable",        "Workmanship of retaining structure": "Not Applicable",        "Side Drain and Catch Water Drain (Earthen)": "Not Applicable",        "General quality of Side Drains/ CatchWater Drains and their integration with CDs.": "Not Applicable",        "Cement Concrete / Semi Rigid Pavements": "Not Applicable",        "Quality of Material – Concrete, Stone/ Concrete Block Pavement etc.": "Not Applicable",        "Strength of CC in Concrete Pavement/ Concrete Block Pavement": "Not Applicable",        "Quality of Workmanship – Wearing surface texture, Adequacy of setting of concrete, Joints, Edges etc.": "Not Applicable",        "Thickness of Layer": "Not Applicable",        "Cement Concrete Pucca Drains": "Not Applicable",        "Thickness of concrete layer": "Not Applicable",        "Strength of concrete": "Not Applicable",        "General Quality of material and Workmanship": "Not Applicable",        "Road Furniture and Markings": "Satisfactory",        "Citizen Information Board, Main Informatory Board, Quality and whether fixed during construction.": "Satisfactory",        "Whether the information in boards is given in local language.": "Satisfactory",        "Overall Grading": "Satisfactory"      }    },    {      "Date": "31 Jan 2023",      "Name": "Kulwant Singh",      "Type": "Road",      "Item": {         "Quality Arrangements": "Satisfactory",        "Attention To Quality": "Satisfactory",        "Maintenance of QC Registers": "Satisfactory",        "Verification of test results": "Satisfactory",        "Geometrics": "Satisfactory",        "Road Way Width": "Satisfactory",        "Carriage Way Width": "Satisfactory",        "Camber": "Satisfactory",        "Super elevation": "Satisfactory",        "Extra Widening at Curves": "Not Applicable",        "Longitudinal Gradient in case of road in hilly/ rolling terrain": "Not Applicable",        "Earthwork and Sub-grade": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Quality of Material for Embankment/Sub-grade": "Not Applicable",        "Compaction": "Satisfactory",        "Adequacy of Slope Protection(in case of high embankments /hilly /rolling terrain)": "Not Applicable",        "Granular Sub-Base (GSB)": "Satisfactory",        "Grain Size": "Not Applicable",        "Plasticity": "Satisfactory",        "Total Thickness of Layer": "Satisfactory",        "Base Course: 1st Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 2nd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 3rd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WMM.": "Satisfactory",        "Bituminous Surface Course": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Gradation of Aggregate": "Satisfactory",        "Laying Temperature of Mix.": "Satisfactory",        "Bitumen content": "Satisfactory",        "Thickness of layer": "Satisfactory",        "Surface Evenness": "Satisfactory",        "Shoulders": "Satisfactory",        "Assessment of New Technology section": "Satisfactory",        "Cross Drainage Works (Pipe Culvert)": "Not Applicable",        "Cushion over Hume pipes including size etc.": "Not Applicable",        "Quality of Workmanship such as positioning of pipes, wing walls, cushion over Hume Pipes etc.": "Not Applicable",        "Cross Drainage Works (Slab Culvert)": "Not Applicable",        "Thickness of Slab": "Not Applicable",        "Quality of material & workmanship": "Not Applicable",        "Protection Work": "Not Applicable",        "Quality of Material": "Not Applicable",        "Workmanship of retaining structure": "Not Applicable",        "Side Drain and Catch Water Drain (Earthen)": "Not Applicable",        "General quality of Side Drains/ CatchWater Drains and their integration with CDs.": "Not Applicable",        "Cement Concrete / Semi Rigid Pavements": "Not Applicable",        "Quality of Material – Concrete, Stone/ Concrete Block Pavement etc.": "Not Applicable",        "Strength of CC in Concrete Pavement/ Concrete Block Pavement": "Not Applicable",        "Quality of Workmanship – Wearing surface texture, Adequacy of setting of concrete, Joints, Edges etc.": "Not Applicable",        "Thickness of Layer": "Not Applicable",        "Cement Concrete Pucca Drains": "Not Applicable",        "Thickness of concrete layer": "Not Applicable",        "Strength of concrete": "Not Applicable",        "General Quality of material and Workmanship": "Not Applicable",        "Road Furniture and Markings": "Satisfactory",        "Citizen Information Board, Main Informatory Board, Quality and whether fixed during construction.": "Satisfactory",        "Whether the information in boards is given in local language.": "Satisfactory",        "Overall Grading": "Satisfactory"      }    },    {      "Date": "27 Jun 2022",      "Name": "Chaudhary P P",      "Type": "Road",      "Item": {         "Quality Arrangements": "Satisfactory",        "Attention To Quality": "Satisfactory",        "Maintenance of QC Registers": "Satisfactory",        "Verification of test results": "Satisfactory",        "Geometrics": "Satisfactory",        "Road Way Width": "Satisfactory",        "Carriage Way Width": "Satisfactory",        "Camber": "Satisfactory",        "Super elevation": "Satisfactory",        "Extra Widening at Curves": "Not Applicable",        "Longitudinal Gradient in case of road in hilly/ rolling terrain": "Not Applicable",        "Earthwork and Sub-grade": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Quality of Material for Embankment/Sub-grade": "Not Applicable",        "Compaction": "Satisfactory",        "Adequacy of Slope Protection(in case of high embankments /hilly /rolling terrain)": "Not Applicable",        "Granular Sub-Base (GSB)": "Satisfactory",        "Grain Size": "Not Applicable",        "Plasticity": "Satisfactory",        "Total Thickness of Layer": "Satisfactory",        "Base Course: 1st Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 2nd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 3rd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WMM.": "Satisfactory",        "Bituminous Surface Course": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Gradation of Aggregate": "Satisfactory",        "Laying Temperature of Mix.": "Satisfactory",        "Bitumen content": "Satisfactory",        "Thickness of layer": "Satisfactory",        "Surface Evenness": "Satisfactory",        "Shoulders": "Satisfactory",        "Assessment of New Technology section": "Satisfactory",        "Cross Drainage Works (Pipe Culvert)": "Not Applicable",        "Cushion over Hume pipes including size etc.": "Not Applicable",        "Quality of Workmanship such as positioning of pipes, wing walls, cushion over Hume Pipes etc.": "Not Applicable",        "Cross Drainage Works (Slab Culvert)": "Not Applicable",        "Thickness of Slab": "Not Applicable",        "Quality of material & workmanship": "Not Applicable",        "Protection Work": "Not Applicable",        "Quality of Material": "Not Applicable",        "Workmanship of retaining structure": "Not Applicable",        "Side Drain and Catch Water Drain (Earthen)": "Not Applicable",        "General quality of Side Drains/ CatchWater Drains and their integration with CDs.": "Not Applicable",        "Cement Concrete / Semi Rigid Pavements": "Not Applicable",        "Quality of Material – Concrete, Stone/ Concrete Block Pavement etc.": "Not Applicable",        "Strength of CC in Concrete Pavement/ Concrete Block Pavement": "Not Applicable",        "Quality of Workmanship – Wearing surface texture, Adequacy of setting of concrete, Joints, Edges etc.": "Not Applicable",        "Thickness of Layer": "Not Applicable",        "Cement Concrete Pucca Drains": "Not Applicable",        "Thickness of concrete layer": "Not Applicable",        "Strength of concrete": "Not Applicable",        "General Quality of material and Workmanship": "Not Applicable",        "Road Furniture and Markings": "Satisfactory",        "Citizen Information Board, Main Informatory Board, Quality and whether fixed during construction.": "Satisfactory",        "Whether the information in boards is given in local language.": "Satisfactory",        "Overall Grading": "Satisfactory"      }    },    {      "Date": "23 Jan 2022",      "Name": "Chaudhary P P",      "Type": "Road",      "Item": {        "Quality Arrangements": "Satisfactory",        "Attention To Quality": "Satisfactory",        "Maintenance of QC Registers": "Satisfactory",        "Verification of test results": "Satisfactory",        "Geometrics": "Satisfactory",        "Road Way Width": "Satisfactory",        "Carriage Way Width": "Satisfactory",        "Camber": "Satisfactory",        "Super elevation": "Satisfactory",        "Extra Widening at Curves": "Not Applicable",        "Longitudinal Gradient in case of road in hilly/ rolling terrain": "Not Applicable",        "Earthwork and Sub-grade": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Quality of Material for Embankment/Sub-grade": "Not Applicable",        "Compaction": "Satisfactory",        "Adequacy of Slope Protection(in case of high embankments /hilly /rolling terrain)": "Not Applicable",        "Granular Sub-Base (GSB)": "Satisfactory",        "Grain Size": "Not Applicable",        "Plasticity": "Satisfactory",        "Total Thickness of Layer": "Satisfactory",        "Base Course: 1st Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 2nd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WBM.": "Satisfactory",        "Base Course: 3rd Layer": "Satisfactory",        "Grain Size of Coarse Aggregate": "Satisfactory",        "Plasticity of Crushable Aggregate used as fillers": "Satisfactory",        "Adequacy of Compaction through Volumetric analysis.": "Satisfactory",        "Thickness of every layer of WMM.": "Satisfactory",        "Bituminous Surface Course": "Satisfactory",        "Assessment of New Technology section": "Not Applicable",        "Gradation of Aggregate": "Satisfactory",        "Laying Temperature of Mix.": "Satisfactory",        "Bitumen content": "Satisfactory",        "Thickness of layer": "Satisfactory",        "Surface Evenness": "Satisfactory",        "Shoulders": "Satisfactory",        "Assessment of New Technology section": "Satisfactory",        "Cross Drainage Works (Pipe Culvert)": "Not Applicable",        "Cushion over Hume pipes including size etc.": "Not Applicable",        "Quality of Workmanship such as positioning of pipes, wing walls, cushion over Hume Pipes etc.": "Not Applicable",        "Cross Drainage Works (Slab Culvert)": "Not Applicable",        "Thickness of Slab": "Not Applicable",        "Quality of material & workmanship": "Not Applicable",        "Protection Work": "Not Applicable",        "Quality of Material": "Not Applicable",        "Workmanship of retaining structure": "Not Applicable",        "Side Drain and Catch Water Drain (Earthen)": "Not Applicable",        "General quality of Side Drains/ CatchWater Drains and their integration with CDs.": "Not Applicable",        "Cement Concrete / Semi Rigid Pavements": "Not Applicable",        "Quality of Material – Concrete, Stone/ Concrete Block Pavement etc.": "Not Applicable",        "Strength of CC in Concrete Pavement/ Concrete Block Pavement": "Not Applicable",        "Quality of Workmanship – Wearing surface texture, Adequacy of setting of concrete, Joints, Edges etc.": "Not Applicable",        "Thickness of Layer": "Not Applicable",        "Cement Concrete Pucca Drains": "Not Applicable",        "Thickness of concrete layer": "Not Applicable",        "Strength of concrete": "Not Applicable",        "General Quality of material and Workmanship": "Not Applicable",        "Road Furniture and Markings": "Satisfactory",        "Citizen Information Board, Main Informatory Board, Quality and whether fixed during construction.": "Satisfactory",        "Whether the information in boards is given in local language.": "Satisfactory",        "Overall Grading": "Satisfactory"      }    }  ]',
          },
        ],
      },
      {
        role: "model",
        parts: [
          {
            text: "| Date | Name | Type | Quality Arrangements | Attention To Quality | Maintenance of QC Registers | Verification of test results | Geometrics | Road Way Width | Carriage Way Width | Camber | Super elevation | Extra Widening at Curves | Longitudinal Gradient in case of road in hilly/ rolling terrain | Earthwork and Sub-grade | Assessment of New Technology section | Quality of Material for Embankment/Sub-grade | Compaction | Adequacy of Slope Protection(in case of high embankments /hilly /rolling terrain) | Granular Sub-Base (GSB) | Grain Size | Plasticity | Total Thickness of Layer | Base Course: 1st Layer | Grain Size of Coarse Aggregate | Plasticity of Crushable Aggregate used as fillers | Adequacy of Compaction through Volumetric analysis. | Thickness of every layer of WBM. | Base Course: 2nd Layer | Grain Size of Coarse Aggregate | Plasticity of Crushable Aggregate used as fillers | Adequacy of Compaction through Volumetric analysis. | Thickness of every layer of WBM. | Base Course: 3rd Layer | Grain Size of Coarse Aggregate | Plasticity of Crushable Aggregate used as fillers | Adequacy of Compaction through Volumetric analysis. | Thickness of every layer of WMM. | Bituminous Surface Course | Assessment of New Technology section | Gradation of Aggregate | Laying Temperature of Mix. | Bitumen content | Thickness of layer | Surface Evenness | Shoulders | Assessment of New Technology section | Cross Drainage Works (Pipe Culvert) | Cushion over Hume pipes including size etc. | Quality of Workmanship such as positioning of pipes, wing walls, cushion over Hume Pipes etc. | Cross Drainage Works (Slab Culvert) | Thickness of Slab | Quality of material & workmanship | Protection Work | Quality of Material | Workmanship of retaining structure | Side Drain and Catch Water Drain (Earthen) | General quality of Side Drains/ CatchWater Drains and their integration with CDs. | Cement Concrete / Semi Rigid Pavements | Quality of Material – Concrete, Stone/ Concrete Block Pavement etc. | Strength of CC in Concrete Pavement/ Concrete Block Pavement | Quality of Workmanship – Wearing surface texture, Adequacy of setting of concrete, Joints, Edges etc. | Thickness of Layer | Cement Concrete Pucca Drains | Thickness of concrete layer | Strength of concrete | General Quality of material and Workmanship | Road Furniture and Markings |",
          },
        ],
      },
    ],
  });

  const result = await chat.sendMessage(
    message || "Tell me the complete information of road inspected by Sidhu Baltej Singh"
  );
  const response = result.response;
  console.log(response.text());

  return response.text();
}
